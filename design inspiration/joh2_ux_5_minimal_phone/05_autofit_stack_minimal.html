<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Joh 2 – Ansatz 5: Auto-Fit Stack</title>
  <style>
    /* Minimal, schwarz/weiß, mobile-first */
    :root {
      --pad: 10px;
      --gap: 8px;
      --line: 1px solid #000;
      --muted: #111;
      --fz: 15px;
      --fzSmall: 13px;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      font-size: var(--fz);
      line-height: 1.25;
      color: #000;
      background: #fff;
      -webkit-text-size-adjust: 100%;
    }
    button, input, select, summary { font: inherit; color: inherit; }
    .app {
      height: 100vh;
      height: 100svh;
      padding: var(--pad);
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: var(--gap);
      overflow: hidden; /* wichtig: kein Scrollen */
    }
    .top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      min-height: 28px;
    }
    .navbtn {
      border: var(--line);
      background: #fff;
      padding: 2px 8px;
      border-radius: 6px;
    }
    .ref {
      font-weight: 600;
      letter-spacing: .2px;
      white-space: nowrap;
    }
    .tiny {
      font-size: var(--fzSmall);
      color: var(--muted);
    }
    .divider { border-top: var(--line); opacity: 1; }
    
  .row { display:flex; gap: 8px; align-items:center; }
  .stack { flex: 1; display: grid; gap: var(--gap); overflow: hidden; }
  .blk { border: var(--line); border-radius: 10px; padding: 6px 8px; overflow: hidden; }
  .h { font-weight: 700; font-size: var(--fzSmall); margin-bottom: 2px; white-space: nowrap; }
  .t { }
  .hideOpt .opt { display:none; }

  </style>
</head>
<body>
  
<div class="app" id="app">
  <div class="top">
    <button class="navbtn" id="prev" aria-label="Vorheriger Vers">‹</button>
    <div class="ref" id="ref">–</div>
    <button class="navbtn" id="next" aria-label="Nächster Vers">›</button>
  </div>

  <div class="row">
    <button class="navbtn" id="toggleCompact" aria-pressed="true">Kompakt</button>
    <button class="navbtn" id="toggleAll" aria-pressed="true">Alles</button>
  </div>

  <div class="stack" id="stack">
    <div class="blk">
      <div class="h">Griechisch</div>
      <div class="t" id="greek"></div>
    </div>
    <div class="blk">
      <div class="h">Wörtlich</div>
      <div class="t" id="literal"></div>
    </div>
    <div class="blk opt" id="blkExt">
      <div class="h">Freier Satz</div>
      <div class="t" id="extreme"></div>
    </div>
    <div class="blk opt" id="blkNotes">
      <div class="h">Analyse</div>
      <div class="t tiny" id="notes"></div>
      <div class="t tiny" id="vocab"></div>
    </div>
  </div>

  <div class="tiny">Idee: 4 Blöcke immer sichtbar; „Kompakt“ und Auto-Fit reduzieren Schrift bis alles auf den Screen passt.</div>
</div>

  <script>
    const DATA = [{"ref": "Joh 2,1", "greek": "Καὶ τῇ ἡμέρᾳ τῇ τρίτῃ γάμος ἐγένετο ἐν Κανᾷ τῆς Γαλιλαίας· καὶ ἦν ἡ μήτηρ τοῦ Ἰησοῦ ἐκεῖ.", "literal": "Und am dritten Tag geschah eine Hochzeit in Kana in Galiläa; und die Mutter Jesu war dort.", "extreme": "Drei Tage später: Hochzeit in Kana. Maria ist schon da.", "notes": "Setting/Ort. Maria wird eingeführt. „Dritter Tag“ kann literarisch den Übergang markieren.", "vocab": "γάμος=Hochzeit; Κανᾷ=Kana; Γαλιλαίας=Galiläa; μήτηρ=Mutter"}, {"ref": "Joh 2,2", "greek": "ἐκλήθη δὲ καὶ ὁ Ἰησοῦς καὶ οἱ μαθηταὶ αὐτοῦ εἰς τὸν γάμον.", "literal": "Es wurde aber auch Jesus und seine Jünger zur Hochzeit eingeladen.", "extreme": "Jesus und seine Jünger sind eingeladen.", "notes": "Motiv: öffentliche Teilnahme. „Jünger“ als bereits bestehender Kreis.", "vocab": "ἐκλήθη=eingeladen; μαθηταὶ=Jünger; εἰς=zu/in"}, {"ref": "Joh 2,3", "greek": "καὶ ὑστερήσαντος οἴνου λέγει ἡ μήτηρ τοῦ Ἰησοῦ πρὸς αὐτόν· Οἶνον οὐκ ἔχουσιν.", "literal": "Und als der Wein ausging, sagt die Mutter Jesu zu ihm: Sie haben keinen Wein.", "extreme": "Der Wein wird knapp. Maria: „Die haben keinen Wein mehr.“", "notes": "Konflikt/Problem. Maria beobachtet und adressiert Jesus indirekt.", "vocab": "οἶνος=Wein; ὑστερέω=fehlen/ausgehen; οὐκ ἔχουσιν=haben nicht"}, {"ref": "Joh 2,4", "greek": "καὶ λέγει αὐτῇ ὁ Ἰησοῦς· Τί ἐμοὶ καὶ σοί, γύναι; οὔπω ἥκει ἡ ὥρα μου.", "literal": "Und Jesus sagt zu ihr: Was ist mir und dir, Frau? Meine Stunde ist noch nicht gekommen.", "extreme": "Jesus: „Was willst du von mir? Es ist noch nicht meine Zeit.“", "notes": "Johanneisches Motiv „Stunde“. Die Anrede „γύναι“ ist höflich, kann aber distanziert wirken.", "vocab": "Τί ἐμοὶ καὶ σοί=Was (ist) mir und dir; γύναι=Frau; ὥρα=Stunde"}, {"ref": "Joh 2,5", "greek": "λέγει ἡ μήτηρ αὐτοῦ τοῖς διακόνοις· Ὅ τι ἂν λέγῃ ὑμῖν ποιήσατε.", "literal": "Seine Mutter sagt zu den Dienern: Was immer er euch sagt, das tut.", "extreme": "Maria zu den Helfern: „Macht einfach, was er sagt.“", "notes": "Maria initiiert Gehorsam/Vertrauen. Übergang zum Handeln (Zeichen).", "vocab": "διάκονοι=Diener/Helfer; Ὅ τι ἂν=was auch immer; ποιήσατε=tut!"}];
    const clamp = (s, n=140) => (s.length<=n? s : s.slice(0, n-1) + "…");
    const save = (k,v)=>localStorage.setItem(k, JSON.stringify(v));
    const load = (k,def)=>{ try { const v=JSON.parse(localStorage.getItem(k)); return (v??def); } catch(e){ return def; } };
    
  let idx = load('joh2_idx_fit', 0);
  let compact = load('joh2_compact', true);
  let showAll = load('joh2_showall', true);

  const $ = (id)=>document.getElementById(id);
  const root = document.getElementById('app');
  const stack = document.getElementById('stack');

  function renderText() {
    const v = DATA[idx];
    $('ref').textContent = v.ref;
    $('greek').textContent = v.greek;
    $('literal').textContent = v.literal;
    $('extreme').textContent = v.extreme;
    $('notes').textContent = v.notes;
    $('vocab').textContent = "Vokabeln: " + v.vocab;
  }

  function setToggles() {
    $('toggleCompact').setAttribute('aria-pressed', String(compact));
    $('toggleAll').setAttribute('aria-pressed', String(showAll));
    root.classList.toggle('hideOpt', !showAll);
    if (compact) {
      document.documentElement.style.setProperty('--fz', '14px');
      document.documentElement.style.setProperty('--fzSmall', '12px');
      document.documentElement.style.setProperty('--gap', '6px');
      document.documentElement.style.setProperty('--pad', '8px');
    } else {
      document.documentElement.style.setProperty('--fz', '15px');
      document.documentElement.style.setProperty('--fzSmall', '13px');
      document.documentElement.style.setProperty('--gap', '8px');
      document.documentElement.style.setProperty('--pad', '10px');
    }
  }

  function fitToScreen() {
    // Ziel: kein Scrollen. Wenn Inhalt zu hoch ist, Schrift schrittweise kleiner.
    const app = document.querySelector('.app');
    const start = 15;
    let size = start;
    const min = 11;

    const apply = (s)=> {
      document.documentElement.style.setProperty('--fz', s + 'px');
      document.documentElement.style.setProperty('--fzSmall', Math.max(10, s-2) + 'px');
    };

    apply(compact ? 14 : 15);
    // Nach dem Setzen iterativ prüfen
    for (let i=0; i<12; i++) {
      const over = app.scrollHeight - app.clientHeight;
      if (over <= 0) break;
      size = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--fz'));
      if (size <= min) break;
      apply(size - 0.5);
    }
  }

  function render() {
    renderText();
    setToggles();
    // Fit nach Layout
    requestAnimationFrame(()=>{ fitToScreen(); });
    save('joh2_idx_fit', idx);
    save('joh2_compact', compact);
    save('joh2_showall', showAll);
  }

  $('toggleCompact').addEventListener('click', ()=>{ compact = !compact; render(); });
  $('toggleAll').addEventListener('click', ()=>{ showAll = !showAll; render(); });

  $('prev').addEventListener('click', () => { idx = (idx - 1 + DATA.length) % DATA.length; render(); });
  $('next').addEventListener('click', () => { idx = (idx + 1) % DATA.length; render(); });

  let x0 = null;
  document.addEventListener('touchstart', (e)=>{ x0 = e.touches[0].clientX; }, {passive:true});
  document.addEventListener('touchend', (e)=>{
    if (x0 == null) return;
    const dx = e.changedTouches[0].clientX - x0;
    if (Math.abs(dx) > 60) { dx < 0 ? $('next').click() : $('prev').click(); }
    x0 = null;
  }, {passive:true});

  window.addEventListener('resize', ()=>{ render(); });

  render();

  </script>
</body>
</html>
