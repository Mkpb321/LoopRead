<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#f2f2f2" />
  <title>LoopRead</title>
  <link rel="apple-touch-icon" sizes="180x180" href="./icon/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="./icon/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="./icon/favicon-16x16.png" />
  <link rel="manifest" href="./icon/site.webmanifest" />
  <link rel="icon" type="image/x-icon" href="./icon/favicon.ico" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar" role="banner">
    <nav class="nav" aria-label="Blocksammlungen Navigation">
      <button id="btnPrev" class="icon-btn reader-only" type="button" aria-label="Zurück">‹</button>

      <div class="nav-center reader-only" aria-live="polite">
        <span id="navIndex" class="nav-index">0/0</span>
      </div>

      <button id="btnNext" class="icon-btn reader-only" type="button" aria-label="Weiter">›</button>
      <button id="btnHighlightTool" class="icon-btn reader-only" type="button" aria-label="Wort-Markieren" aria-pressed="false">✦</button>
      <button id="btnMarkerTool" class="icon-btn reader-only" type="button" aria-label="Einmal markieren" aria-pressed="false">✎</button>
      <button id="btnClearHighlights" class="icon-btn reader-only" type="button" aria-label="Alle Markierungen löschen">✕</button>
      
      <button id="btnMenu" class="icon-btn" type="button" aria-label="Menü öffnen" aria-haspopup="true" aria-controls="menuDrawer">☰</button>
    </nav>
  </header>

  <div id="toast" class="toast" role="status" aria-live="polite" hidden>
    <span id="toastMsg" class="toast-msg"></span>
    <button id="toastClose" class="toast-close" type="button" aria-label="Meldung schließen">×</button>
  </div>

  <div id="confirmOverlay" class="confirm-overlay" hidden></div>
  <div id="confirmBox" class="confirm-box" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="confirm-msg" id="confirmMsg"></div>
    <div class="confirm-actions">
      <button id="confirmCancel" class="btn btn-ghost" type="button">Abbrechen</button>
      <button id="confirmOk" class="btn" type="button">OK</button>
    </div>
  </div>

  <div id="markerNoteOverlay" class="confirm-overlay" hidden></div>
  <div id="markerNoteBox" class="note-box" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="note-title" id="markerNoteTitle">Notiz</div>
    <div class="note-sub" id="markerNoteSub"></div>
    <label class="label" for="markerNoteText">Notiz</label>
    <textarea id="markerNoteText" class="textarea" rows="5" placeholder="Notiz eingeben (optional)"></textarea>
    <div class="note-actions">
      <button id="markerNoteCancel" class="btn btn-ghost" type="button">Abbrechen</button>
      <button id="markerNoteDelete" class="btn btn-danger" type="button">Markierung löschen</button>
      <button id="markerNoteSave" class="btn" type="button">Speichern</button>
    </div>
  </div>

  <main class="main" role="main">
    <!-- Login View -->
    <section id="view-login" class="view" aria-label="Login">
      <div class="login-wrap">
        <h1 class="login-title">LoopRead Login</h1>
        <p class="login-hint">Bitte einloggen, um LoopRead zu verwenden.</p>

        <form id="loginForm" class="login-form" autocomplete="off">
          <label class="login-label" for="loginEmail">E-Mail</label>
          <input id="loginEmail" class="input" type="email" inputmode="email" autocomplete="username" required />

          <label class="login-label" for="loginPassword">Passwort</label>
          <input id="loginPassword" class="input" type="password" autocomplete="current-password" required />

          <button id="btnLogin" class="btn" type="submit">Einloggen</button>
        </form>
      </div>
    </section>

    <!-- Reader View -->
    
    <!-- Projects View -->
    <section id="view-projects" class="view" aria-label="Projekte">
      <div class="view-inner">
        <h2 class="view-title">Projekte</h2>
        <p class="view-subtitle">Projekte trennen deine Sammlungen und Textblöcke vollständig voneinander.</p>

        <div class="form">
          <label class="label" for="projectNewName">Neues Projekt</label>
          <input id="projectNewName" class="input" type="text" placeholder="Projektname" autocomplete="off" />
          <button id="btnCreateProject" class="btn" type="button">Projekt erstellen</button>
        </div>

        <div id="projectsList" class="projects-grid" aria-live="polite"></div>

        <div class="actions">
          <button id="btnProjectsBack" class="btn btn-ghost" type="button">Zurück</button>
        </div>
      </div>
    </section>

<section id="view-reader" class="view" aria-label="Lesen">
      <div id="blocksContainer" class="blocks" aria-live="polite"></div>
    </section>

    <!-- Add Collection View -->
    <section id="view-add" class="view" aria-label="Neue Blocksammlung">
      <div class="add-header">
        <h1 class="add-title">Neue Blocksammlung</h1>
        <p class="add-hint">Fülle Titel und Inhalt pro Textblock aus. Sobald alle sichtbaren Felder ausgefüllt sind, erscheint automatisch ein weiterer Block.</p>
      </div>

      <form id="addForm" class="add-form" autocomplete="off">
        <div id="editors" class="editors"></div>

        <div class="add-actions">
          <button id="btnSave" class="btn" type="submit">Speichern</button>
          <button id="btnCancel" class="btn btn-ghost" type="button">Abbrechen</button>
        </div>
      </form>
    </section>

    <!-- Import View -->
    <section id="view-import" class="view" aria-label="Import">
      <div class="add-header">
        <h1 class="add-title">Import</h1>
        <p class="add-hint">
          Je Tabellenblatt: Zeile 1 enthält die Titel (Spalten). Ab Zeile 2 ist jede Zeile eine Blocksammlung. Pflichtfelder dürfen nicht leer sein. Mehrere Tabellenblätter werden gemeinsam importiert.
        </p>
      </div>

      <form id="importForm" class="add-form" autocomplete="off">
        <div class="editor">
          <div class="editor-label">Datei</div>
          <input id="importFile" class="input" type="file" accept=".xlsx,.xls,.csv" />
          <div id="importInfo" class="import-info"></div>
        </div>

        <div class="editor">
          <div class="editor-label">Importmodus</div>
          <label class="radio">
            <input type="radio" name="importMode" value="append" checked />
            <span>Anhängen</span>
          </label>
          <label class="radio">
            <input type="radio" name="importMode" value="replace" />
            <span>Ersetzen</span>
          </label>
        </div>

        <div class="add-actions">
          <button id="btnImport" class="btn" type="submit">Importieren</button>
          <button id="btnImportCancel" class="btn btn-ghost" type="button">Abbrechen</button>
        </div>
        <div class="drawer-sep" role="separator" aria-hidden="true"></div>
        <p class="add-hint">Exportiert alle gespeicherten Sammlungen als Excel-Datei (.xlsx). Wenn Titel/Reihenfolge zwischen Sammlungen abweichen, werden mehrere Tabellenblätter erzeugt.</p>
        <div class="add-actions">
          <button id="btnExport" class="btn" type="button">Exportieren (Excel)</button>
        </div>
      </form>
    </section>

    <!-- Delete Collections View -->
    <section id="view-delete" class="view" aria-label="Sammlungen löschen">
      <div class="add-header">
        <h1 class="add-title">Sammlungen löschen</h1>
        <p class="add-hint">Tippe auf ✕, um eine Sammlung zum Löschen zu markieren. Gelöscht wird erst beim Speichern.</p>
      </div>

      <div id="deleteCollections" class="collections-grid" aria-live="polite"></div>

      <div class="add-form">
        <div class="add-actions">
          <button id="btnDeleteSave" class="btn" type="button">Speichern</button>
          <button id="btnDeleteCancel" class="btn btn-ghost" type="button">Abbrechen</button>
        </div>
      </div>
    </section>

    <!-- Hide Blocks View -->
<section id="view-hide" class="view" aria-label="Textblöcke ausblenden">
  <div class="add-header">
    <h1 class="add-title">Textblöcke ausblenden</h1>
    <p class="add-hint">Wähle Textblöcke, die in der gesamten App ausgeblendet werden sollen. Die Inhalte bleiben gespeichert und können jederzeit wieder eingeblendet werden.</p>
  </div>

  <div id="hideBlocksList" class="hide-blocks-list" aria-live="polite"></div>

  <div class="add-form">
    <div class="add-actions">
      <button id="btnHideSave" class="btn" type="button">Speichern</button>
      <button id="btnHideCancel" class="btn btn-ghost" type="button">Abbrechen</button>
    </div>
  </div>
</section>

  
    <!-- Notes View -->
    <section id="view-notes" class="view" aria-label="Markierungen &amp; Notizen">
      <div class="add-header">
        <h1 class="add-title">Markierungen &amp; Notizen</h1>
        <p class="add-hint">Hier siehst du alle Markierungen im aktuellen Projekt. Tippe auf eine Markierung, um direkt zur Stelle zu springen.</p>
      </div>

      <div id="notesList" class="notes-list" aria-live="polite"></div>

      <div class="actions">
        <button id="btnNotesBack" class="btn btn-ghost" type="button">Zurück</button>
      </div>
    </section>

    <!-- Help View -->
    <section id="view-help" class="view" aria-label="Hilfe">
      <div class="add-header">
        <h1 class="add-title">Hilfe</h1>
        <p class="add-hint">Kurz erklärt: Seiten, Tools und typische Abläufe.</p>
      </div>

      <div class="help" aria-live="polite">
        <p class="help-note"><strong>Speicherung:</strong> Alle Projekte, Sammlungen und Markierungen werden online in Firestore gespeichert (kein lokaler Browser-Speicher mehr).</p>
        <h2 class="help-h2">Seiten</h2>
        <ul class="help-list">
          <li><strong>Projekte</strong>: Projekte anlegen, umbenennen, löschen, laden. Jedes Projekt hat eigene Sammlungen/Markierungen.</li>
          <li><strong>Lesen</strong>: Durch Textblöcke blättern und Tools verwenden.</li>
          <li><strong>Neue Blocksammlung</strong>: Sammlung anlegen (Titel + mehrere Textblöcke).</li>
          <li><strong>Import/Export</strong>: Excel importieren/exportieren (immer nur im aktuellen Projekt).</li>
          <li><strong>Sammlungen löschen</strong>: Sammlungen markieren und anschließend speichern.</li>
          <li><strong>Textblöcke ausblenden</strong>: Blöcke global im Projekt ausblenden/einblenden.</li>
          <li><strong>Markierungen &amp; Notizen</strong>: Alle Markierungen ansehen, bearbeiten und löschen.</li>
        </ul>

        <h2 class="help-h2">Tools (nur in „Lesen“ sichtbar)</h2>
        <ul class="help-list">
          <li><strong>✦ Highlight</strong>: Wörter highlighten. Tippe auf ein Wort, um es ein/aus zu highlighten.</li>
          <li><strong>✎ Marker</strong>: Markierung mit Notiz. Tippe Startwort, dann Endwort (erneut Startwort = 1 Wort). Danach öffnet sich die Notiz.</li>
          <li><strong>✕ Löschen</strong>: Entfernt alle Highlights im aktuellen Textblock.</li>
        </ul>

        <h2 class="help-h2">Markierungen &amp; Notizen</h2>
        <ul class="help-list">
          <li><strong>Anzeigen</strong>: Zeigt die zugehörige Textblock-Sammlung inline (Markierungen rot/fett/unterstrichen).</li>
          <li><strong>Bearbeiten</strong>: Öffnet die Notiz zur Markierung.</li>
          <li><strong>Löschen</strong>: Entfernt Markierung und Notiz.</li>
        </ul>
      </div>

      <div class="actions">
        <button id="btnHelpBack" class="btn btn-ghost" type="button">Zurück</button>
      </div>
    </section>

  </main>

  <!-- Menu Drawer -->
  <div id="menuOverlay" class="overlay" hidden></div>
  <aside id="menuDrawer" class="drawer" role="dialog" aria-label="Menü" aria-modal="true" aria-hidden="true">
    <div class="drawer-inner">
      <div class="drawer-title">LoopRead <span id="drawerProjectName" class="drawer-project-name"></span></div>

      <button id="menuToReader" class="drawer-item primary" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 19.5V5.5A2.5 2.5 0 0 1 6.5 3H20v18H6.5A2.5 2.5 0 0 0 4 23.5"/><path d="M8 7h8"/><path d="M8 11h8"/><path d="M8 15h6"/></svg></span><span class="drawer-text">Lesen</span></button>
      <button id="menuToProjects" class="drawer-item" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 7a2 2 0 0 1 2-2h5l2 2h9a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3Z"/><path d="M3 10h22"/></svg></span><span class="drawer-text">Projekte</span></button>
      <button id="menuToNotes" class="drawer-item" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M14 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9Z"/><path d="M14 3v6h6"/><path d="M8 13h8"/><path d="M8 17h6"/></svg></span><span class="drawer-text">Markierungen &amp; Notizen</span></button>
      <button id="menuToAdd" class="drawer-item" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5v14"/><path d="M5 12h14"/><path d="M4 4h16v16H4z" /></svg></span><span class="drawer-text">Neue Blocksammlung</span></button>
      <button id="menuToImport" class="drawer-item" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v10"/><path d="M8 9l4 4 4-4"/><path d="M4 17v3h16v-3"/></svg></span><span class="drawer-text">Import</span></button>
      <button id="menuExport" class="drawer-item" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 21V11"/><path d="M8 15l4-4 4 4"/><path d="M4 7V4h16v3"/></svg></span><span class="drawer-text">Export (Excel)</span></button>
      <button id="menuToHide" class="drawer-item" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12Z"/><path d="M9.5 9.5a3.5 3.5 0 0 0 5 5"/><path d="M3 3l18 18"/></svg></span><span class="drawer-text">Textblöcke ausblenden</span></button>
      <button id="menuToDelete" class="drawer-item" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M6 6l1 16h10l1-16"/><path d="M10 11v6"/><path d="M14 11v6"/></svg></span><span class="drawer-text">Sammlungen löschen</span></button>
      <button id="menuToHelp" class="drawer-item" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 18h.01"/><path d="M9.1 9a3 3 0 0 1 5.8 1c0 2-3 2-3 4"/><path d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z"/></svg></span><span class="drawer-text">Hilfe</span></button>
<div class="drawer-sep" role="separator" aria-hidden="true"></div>

      <button id="menuLoadSample" class="drawer-item" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2l1.2 4.2L17 7l-3.8 1.1L12 12l-1.2-3.9L7 7l3.8-.8Z"/><path d="M19 12l.8 2.7L22 15l-2.2.7L19 18l-.8-2.3L16 15l2.2-.3Z"/><path d="M5 13l.8 2.7L8 16l-2.2.7L5 19l-.8-2.3L2 16l2.2-.3Z"/></svg></span><span class="drawer-text">Probedaten laden</span></button>      <button id="menuLogout" class="drawer-item" type="button"><span class="drawer-icon"><svg class="drawer-svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M10 17l-1 0a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h1"/><path d="M15 12H7"/><path d="M15 12l-3-3"/><path d="M15 12l-3 3"/><path d="M17 7h4v10h-4"/></svg></span><span class="drawer-text">Logout</span></button>
</div>
  </aside>

  <!-- Firebase (Auth + Firestore) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- SheetJS (XLSX/CSV Import) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="app.core.js"></script>
  <script src="app.highlight.js"></script>
  <script src="app.views.js"></script>
  <script src="app.main.js"></script>
</body>
</html>
