<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#f2f2f2" />
  <title>LoopRead</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar" role="banner">
    <nav class="nav" aria-label="Blocksammlungen Navigation">
      <button id="btnPrev" class="icon-btn" type="button" aria-label="Zurück">‹</button>

      <div class="nav-center" aria-live="polite">
        <span id="navIndex" class="nav-index">0/0</span>
      </div>

      <button id="btnNext" class="icon-btn" type="button" aria-label="Weiter">›</button>
      <button id="btnMenu" class="icon-btn" type="button" aria-label="Menü öffnen" aria-haspopup="true" aria-controls="menuDrawer">☰</button>
    </nav>
  </header>

  <div id="toast" class="toast" role="status" aria-live="polite" hidden></div>

  <main class="main" role="main">
    <!-- Login View -->
    <section id="view-login" class="view" aria-label="Login">
      <div class="login-wrap">
        <h1 class="login-title">LoopRead Login</h1>
        <p class="login-hint">Bitte einloggen, um LoopRead zu verwenden.</p>

        <form id="loginForm" class="login-form" autocomplete="off">
          <label class="login-label" for="loginEmail">E-Mail</label>
          <input id="loginEmail" class="input" type="email" inputmode="email" autocomplete="username" required />

          <label class="login-label" for="loginPassword">Passwort</label>
          <input id="loginPassword" class="input" type="password" autocomplete="current-password" required />

          <button id="btnLogin" class="btn" type="submit">Einloggen</button>
        </form>

        <div class="login-footnote">Keine Registrierung in der App. Nutzer werden in Firebase (Admin) angelegt.</div>
      </div>
    </section>

    <!-- Reader View -->
    <section id="view-reader" class="view" aria-label="Lesen">
      <div id="blocksContainer" class="blocks" aria-live="polite"></div>
    </section>

    <!-- Add Collection View -->
    <section id="view-add" class="view" aria-label="Neue Blocksammlung">
      <div class="add-header">
        <h1 class="add-title">Neue Blocksammlung</h1>
        <p class="add-hint">Fülle Titel und Inhalt pro Textblock aus. Sobald alle sichtbaren Felder ausgefüllt sind, erscheint automatisch ein weiterer Block.</p>
      </div>

      <form id="addForm" class="add-form" autocomplete="off">
        <div id="editors" class="editors"></div>

        <div class="add-actions">
          <button id="btnSave" class="btn" type="submit">Speichern</button>
          <button id="btnCancel" class="btn btn-ghost" type="button">Abbrechen</button>
        </div>
      </form>
    </section>

    <!-- Import View -->
    <section id="view-import" class="view" aria-label="Import">
      <div class="add-header">
        <h1 class="add-title">Import</h1>
        <p class="add-hint">
          Zeile 1 enthält die Titel (Spalten). Ab Zeile 2 ist jede Zeile eine Blocksammlung. Pflichtfelder dürfen nicht leer sein.
        </p>
      </div>

      <form id="importForm" class="add-form" autocomplete="off">
        <div class="editor">
          <div class="editor-label">Datei</div>
          <input id="importFile" class="input" type="file" accept=".xlsx,.xls,.csv" />
          <div id="importInfo" class="import-info"></div>
        </div>

        <div class="editor">
          <div class="editor-label">Importmodus</div>
          <label class="radio">
            <input type="radio" name="importMode" value="append" checked />
            <span>Anhängen</span>
          </label>
          <label class="radio">
            <input type="radio" name="importMode" value="replace" />
            <span>Ersetzen</span>
          </label>
        </div>

        <div class="add-actions">
          <button id="btnImport" class="btn" type="submit">Importieren</button>
          <button id="btnImportCancel" class="btn btn-ghost" type="button">Abbrechen</button>
        </div>
      </form>
    </section>
  </main>

  <!-- Menu Drawer -->
  <div id="menuOverlay" class="overlay" hidden></div>
  <aside id="menuDrawer" class="drawer" role="dialog" aria-label="Menü" aria-modal="true" aria-hidden="true">
    <div class="drawer-inner">
      <div class="drawer-title">LoopRead</div>

      <button id="menuToReader" class="drawer-item" type="button">Lesen</button>
      <button id="menuToAdd" class="drawer-item" type="button">Neue Blocksammlung</button>
      <button id="menuToImport" class="drawer-item" type="button">Import</button>

      <div class="drawer-sep" role="separator" aria-hidden="true"></div>

      <button id="menuLoadSample" class="drawer-item" type="button">Probedaten laden</button>
      <button id="menuClearAll" class="drawer-item danger" type="button">Alle Daten löschen</button>
      <button id="menuLogout" class="drawer-item" type="button">Logout</button>

      <div class="drawer-footnote">
        Daten werden lokal im Browser gespeichert (localStorage) – getrennt pro Firebase-User.
      </div>
    </div>
  </aside>

  <!-- Firebase (Auth only) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <!-- SheetJS (XLSX/CSV Import) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script src="app.js"></script>
</body>
</html>
